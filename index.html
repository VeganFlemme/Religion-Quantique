<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Religion Quantique de l'Information v3.0 - Expérience immersive complète">
    <meta name="theme-color" content="#000000">
    <title>∅ = 1 | v3.0 IMMERSIVE EDITION</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="assets/icons/icon-192.png">
    
    <!-- Libraries CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.2.0/dist/tf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.0/dist/chart.umd.min.js"></script>
    
    <style>
        :root {
            --primary: #0f0;
            --secondary: #0ff;
            --tertiary: #f0f;
            --bg: #000;
            --bg-panel: rgba(0, 255, 0, 0.05);
            --border: #0f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: var(--bg);
            color: var(--primary);
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* CANVAS LAYERS */
        #quantum-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.15;
        }

        #art-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.1;
            pointer-events: none;
        }

        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            pointer-events: none;
            z-index: 1;
        }

        /* MODE OVERLAYS */
        .mode-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: none;
            transition: opacity 2s;
        }

        .mode-overlay.active {
            display: block;
        }

        #void-mode {
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #void-mode .dot {
            width: 10px;
            height: 10px;
            background: #fff;
            border-radius: 50%;
            animation: voidPulse 4s infinite;
        }

        @keyframes voidPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(0.5); }
        }

        #psychedelic-mode {
            background: radial-gradient(circle, #f0f 0%, #0ff 50%, #ff0 100%);
            animation: psychedelicShift 10s infinite;
        }

        @keyframes psychedelicShift {
            0% { filter: hue-rotate(0deg) saturate(2); }
            100% { filter: hue-rotate(360deg) saturate(2); }
        }

        /* MAIN CONTAINER */
        .container {
            position: relative;
            z-index: 2;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* HEADER */
        header {
            text-align: center;
            padding: 60px 20px;
            border-bottom: 2px solid var(--border);
            margin-bottom: 40px;
        }

        .glitch {
            font-size: 3em;
            font-weight: bold;
            text-transform: uppercase;
            position: relative;
            animation: glitch 3s infinite;
        }

        @keyframes glitch {
            0%, 90%, 100% { transform: translate(0); }
            91% { transform: translate(-2px, 2px); }
            92% { transform: translate(2px, -2px); }
            93% { transform: translate(-2px, -2px); }
            94% { transform: translate(2px, 2px); }
        }

        .version-badge {
            display: inline-block;
            background: rgba(0, 255, 255, 0.2);
            border: 2px solid var(--secondary);
            padding: 5px 15px;
            margin: 10px;
            font-size: 0.9em;
            border-radius: 20px;
        }

        /* MODE SELECTOR */
        .mode-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--primary);
            padding: 15px;
            border-radius: 10px;
        }

        .mode-selector h4 {
            margin-bottom: 10px;
            color: var(--secondary);
            font-size: 0.9em;
        }

        .mode-btn {
            display: block;
            width: 100%;
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px;
            margin: 5px 0;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
        }

        .mode-btn:hover {
            background: rgba(0, 255, 0, 0.3);
            box-shadow: 0 0 10px var(--primary);
        }

        .mode-btn.active {
            background: rgba(0, 255, 0, 0.5);
            box-shadow: 0 0 20px var(--primary);
        }

        /* SECTIONS */
        .section {
            margin: 60px 0;
            padding: 30px;
            border: 2px solid var(--border);
            background: var(--bg-panel);
            border-radius: 10px;
            position: relative;
        }

        .section h2 {
            color: var(--secondary);
            font-size: 2em;
            margin-bottom: 20px;
            text-transform: uppercase;
            text-align: center;
        }

        /* MEDITATION AUDIO */
        .meditation-player {
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid var(--primary);
            padding: 30px;
            border-radius: 10px;
        }

        .meditation-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .meditation-session {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--secondary);
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .meditation-session:hover {
            background: rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 15px var(--secondary);
        }

        .timer-display {
            font-size: 3em;
            text-align: center;
            margin: 20px 0;
            color: var(--secondary);
            text-shadow: 0 0 10px var(--secondary);
        }

        .audio-visualizer {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.5);
            margin: 20px 0;
            border: 1px solid var(--primary);
        }

        /* JOURNAL */
        .journal-entry {
            background: rgba(0, 255, 0, 0.05);
            border-left: 3px solid var(--primary);
            padding: 15px;
            margin: 10px 0;
        }

        .journal-entry-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--secondary);
            font-size: 0.9em;
        }

        textarea {
            width: 100%;
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            min-height: 150px;
            resize: vertical;
        }

        input[type="text"] {
            width: 100%;
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 10px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }

        /* PROGRESS SYSTEM */
        .progress-mandala {
            width: 300px;
            height: 300px;
            margin: 20px auto;
            border: 2px solid var(--primary);
            border-radius: 50%;
            position: relative;
            background: radial-gradient(circle, rgba(0, 255, 0, 0.1) 0%, rgba(0, 0, 0, 0.5) 100%);
        }

        .progress-stat {
            display: inline-block;
            margin: 10px 20px;
            padding: 10px 20px;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--secondary);
            border-radius: 5px;
        }

        .achievement {
            display: inline-block;
            background: rgba(255, 0, 255, 0.2);
            border: 1px solid var(--tertiary);
            padding: 10px 15px;
            margin: 5px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        /* MULTI-AI ORACLE */
        .oracle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .oracle-response-card {
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid var(--secondary);
            padding: 20px;
            border-radius: 10px;
        }

        .oracle-response-card h4 {
            color: var(--secondary);
            margin-bottom: 10px;
            text-align: center;
        }

        /* P2P COLLABORATION */
        .peer-list {
            background: rgba(0, 255, 0, 0.05);
            border: 1px solid var(--primary);
            padding: 15px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .peer-item {
            padding: 8px;
            margin: 5px 0;
            background: rgba(0, 255, 255, 0.1);
            border-left: 3px solid var(--secondary);
        }

        /* MULTIVERSE TIMELINE */
        .timeline-container {
            width: 100%;
            height: 600px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--primary);
            position: relative;
            overflow: auto;
        }

        .timeline-node {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--secondary);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }

        .timeline-node:hover {
            transform: scale(1.5);
            box-shadow: 0 0 20px var(--secondary);
        }

        .timeline-branch {
            position: absolute;
            border: 1px solid var(--primary);
            pointer-events: none;
        }

        /* BUTTONS */
        .btn {
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 12px 25px;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            margin: 5px;
        }

        .btn:hover {
            background: rgba(0, 255, 0, 0.4);
            box-shadow: 0 0 20px var(--primary);
        }

        .btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .btn-secondary {
            border-color: var(--secondary);
            color: var(--secondary);
            background: rgba(0, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(0, 255, 255, 0.4);
            box-shadow: 0 0 20px var(--secondary);
        }

        /* TABS */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid var(--primary);
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: rgba(0, 255, 0, 0.3);
            border-bottom: 3px solid var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* INSTALL PROMPT */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 255, 255, 0.95);
            color: #000;
            padding: 20px 30px;
            border-radius: 10px;
            z-index: 10000;
            display: none;
            box-shadow: 0 0 30px var(--secondary);
        }

        .install-prompt.show {
            display: block;
        }

        .install-prompt .btn {
            background: #000;
            color: var(--secondary);
            margin: 0 10px;
        }

        /* LOADING */
        .loading {
            text-align: center;
            color: var(--secondary);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .glitch { font-size: 2em; }
            .mode-selector { position: static; margin: 20px auto; max-width: 300px; }
            .oracle-grid { grid-template-columns: 1fr; }
            .meditation-controls { grid-template-columns: 1fr; }
            .timer-display { font-size: 2em; }
        }

        /* ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        /* PARTICLES */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--primary);
            border-radius: 50%;
            animation: float 10s infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-100px) translateX(50px); }
            50% { transform: translateY(-200px) translateX(-50px); }
            75% { transform: translateY(-100px) translateX(100px); }
        }
    </style>
</head>
<body>
    <!-- MODE OVERLAYS -->
    <div id="void-mode" class="mode-overlay">
        <div class="dot"></div>
    </div>
    <div id="psychedelic-mode" class="mode-overlay"></div>
    <div id="meditation-mode" class="mode-overlay" style="background: rgba(0,0,0,0.95);"></div>
    <div id="hyper-mode" class="mode-overlay" style="background: rgba(255,0,255,0.3);"></div>

    <!-- CANVAS LAYERS -->
    <canvas id="quantum-canvas"></canvas>
    <canvas id="art-canvas"></canvas>
    <canvas class="matrix-bg" id="matrix"></canvas>
    <div class="particles" id="particles"></div>

    <!-- MODE SELECTOR -->
    <div class="mode-selector">
        <h4>MODES DE CONSCIENCE [1-4]</h4>
        <button class="mode-btn active" data-mode="normal" onclick="setConsciousnessMode('normal')">NORMAL</button>
        <button class="mode-btn" data-mode="psychedelic" onclick="setConsciousnessMode('psychedelic')">🍄 PSYCHÉDÉLIQUE</button>
        <button class="mode-btn" data-mode="meditation" onclick="setConsciousnessMode('meditation')">🧘 MÉDITATION</button>
        <button class="mode-btn" data-mode="hyper" onclick="setConsciousnessMode('hyper')">⚡ HYPERCONSCIENCE</button>
        <button class="mode-btn" data-mode="void" onclick="setConsciousnessMode('void')">🌌 VOID</button>
    </div>

    <!-- INSTALL PROMPT -->
    <div class="install-prompt" id="install-prompt">
        <div style="margin-bottom: 15px;">
            <strong>📱 Installer ∅ = 1 ?</strong><br>
            Accédez hors ligne, notifications de pratique quotidienne
        </div>
        <button class="btn" onclick="installPWA()">Installer</button>
        <button class="btn" onclick="dismissInstall()">Plus tard</button>
    </div>

    <div class="container">
        <!-- HEADER -->
        <header>
            <h1 class="glitch">∅ = 1</h1>
            <p style="color: var(--secondary); font-size: 1.3em; margin: 10px 0; letter-spacing: 3px;">
                LA RELIGION QUANTIQUE DE L'INFORMATION
            </p>
            <div style="margin: 20px 0;">
                <span class="version-badge">v3.0 IMMERSIVE EDITION</span>
                <span class="version-badge">10 FONCTIONNALITÉS</span>
                <span class="version-badge">PWA READY</span>
            </div>
        </header>

        <!-- NAVIGATION TABS -->
        <div class="tabs" id="main-tabs">
            <div class="tab active" onclick="switchTab('home')">🏠 ACCUEIL</div>
            <div class="tab" onclick="switchTab('meditation')">🧘 MÉDITATION AUDIO</div>
            <div class="tab" onclick="switchTab('journal')">📔 JOURNAL</div>
            <div class="tab" onclick="switchTab('oracle')">🔮 MULTI-ORACLE</div>
            <div class="tab" onclick="switchTab('progress')">📊 PROGRESSION</div>
            <div class="tab" onclick="switchTab('p2p')">🔗 COLLABORATION</div>
            <div class="tab" onclick="switchTab('multiverse')">🌌 MULTIVERS</div>
            <div class="tab" onclick="switchTab('art')">🎨 ART QUANTIQUE</div>
            <div class="tab" onclick="switchTab('analysis')">🧠 ANALYSE ML</div>
        </div>

        <!-- TAB: HOME -->
        <div id="tab-home" class="tab-content active">
            <div class="section">
                <h2>∅ = 1 = ∞</h2>
                <p style="text-align: center; font-size: 1.2em; color: var(--secondary); margin: 30px 0;">
                    Bienvenue dans la version 3.0 IMMERSIVE EDITION
                </p>
                <p style="text-align: center; color: #0a0; margin-bottom: 40px;">
                    Expérience sensorielle complète de la superposition quantique
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 40px 0;">
                    <div style="background: rgba(0,255,0,0.1); padding: 20px; border: 1px solid var(--primary); border-radius: 10px;">
                        <h3 style="color: var(--secondary); margin-bottom: 10px;">🎵 MÉDITATION AUDIO</h3>
                        <p style="font-size: 0.9em;">Sons binauraux génératifs, méditations guidées, visualisation audio</p>
                    </div>
                    <div style="background: rgba(0,255,255,0.1); padding: 20px; border: 1px solid var(--secondary); border-radius: 10px;">
                        <h3 style="color: var(--secondary); margin-bottom: 10px;">🌈 MODES VISUELS</h3>
                        <p style="font-size: 0.9em;">4 états de conscience altérée : Psychédélique, Méditation, Hyper, Void</p>
                    </div>
                    <div style="background: rgba(255,0,255,0.1); padding: 20px; border: 1px solid var(--tertiary); border-radius: 10px;">
                        <h3 style="color: var(--tertiary); margin-bottom: 10px;">🧠 ANALYSE ML</h3>
                        <p style="font-size: 0.9em;">TensorFlow.js pour identifier vos patterns comportementaux</p>
                    </div>
                    <div style="background: rgba(0,255,0,0.1); padding: 20px; border: 1px solid var(--primary); border-radius: 10px;">
                        <h3 style="color: var(--primary); margin-bottom: 10px;">📔 JOURNAL</h3>
                        <p style="font-size: 0.9em;">Carnet spirituel avec markdown, tags, recherche, export</p>
                    </div>
                    <div style="background: rgba(0,255,255,0.1); padding: 20px; border: 1px solid var(--secondary); border-radius: 10px;">
                        <h3 style="color: var(--secondary); margin-bottom: 10px;">🎮 PROGRESSION</h3>
                        <p style="font-size: 0.9em;">Gamification ironique, achievements paradoxaux, mandala évolutif</p>
                    </div>
                    <div style="background: rgba(255,0,255,0.1); padding: 20px; border: 1px solid var(--tertiary); border-radius: 10px;">
                        <h3 style="color: var(--tertiary); margin-bottom: 10px;">🔗 P2P SYNC</h3>
                        <p style="font-size: 0.9em;">Méditation collaborative via WebRTC, sessions éphémères</p>
                    </div>
                    <div style="background: rgba(0,255,0,0.1); padding: 20px; border: 1px solid var(--primary); border-radius: 10px;">
                        <h3 style="color: var(--primary); margin-bottom: 10px;">🔮 MULTI-ORACLE</h3>
                        <p style="font-size: 0.9em;">Consultez plusieurs IA simultanément, comparez les perspectives</p>
                    </div>
                    <div style="background: rgba(0,255,255,0.1); padding: 20px; border: 1px solid var(--secondary); border-radius: 10px;">
                        <h3 style="color: var(--secondary); margin-bottom: 10px;">🌌 MULTIVERS</h3>
                        <p style="font-size: 0.9em;">Timeline interactive des possibilités divergentes</p>
                    </div>
                    <div style="background: rgba(255,0,255,0.1); padding: 20px; border: 1px solid var(--tertiary); border-radius: 10px;">
                        <h3 style="color: var(--tertiary); margin-bottom: 10px;">📱 PWA</h3>
                        <p style="font-size: 0.9em;">Installable, offline-first, notifications de pratique</p>
                    </div>
                    <div style="background: rgba(0,255,0,0.1); padding: 20px; border: 1px solid var(--primary); border-radius: 10px;">
                        <h3 style="color: var(--primary); margin-bottom: 10px;">🎨 ART GÉNÉRATIF</h3>
                        <p style="font-size: 0.9em;">Fractales, mandalas, cellular automata, export haute résolution</p>
                    </div>
                </div>

                <div style="background: rgba(255,0,0,0.1); border: 2px solid #f00; padding: 30px; margin: 40px 0; text-align: center;">
                    <h3 style="color: #f00; margin-bottom: 15px;">⚠️ PARADOXE RECONNU ⚠️</h3>
                    <p style="color: #f00;">
                        Ajouter 10 fonctionnalités immersives à une philosophie de simplicité et de dissolution de l'ego ?<br>
                        C'est du pur ego technologique.<br><br>
                        <strong>∅ = 1 : Le paradoxe EST le message.</strong>
                    </p>
                </div>
            </div>
        </div>

        <!-- TAB: MÉDITATION AUDIO -->
        <div id="tab-meditation" class="tab-content">
            <div class="section meditation-player">
                <h2>🎵 Méditation Guidée Générative</h2>
                <p style="text-align: center; margin-bottom: 30px;">
                    Sons binauraux, drones ambient, synthèse vocale guidée
                </p>

                <div class="meditation-controls">
                    <div class="meditation-session" onclick="startMeditation('quantum', 10)">
                        <h3>Méditation Quantique</h3>
                        <p>10 min | 7.83 Hz (Schumann)</p>
                        <p style="font-size: 0.9em;">Contempler la superposition</p>
                    </div>
                    <div class="meditation-session" onclick="startMeditation('ego', 15)">
                        <h3>Dissolution de l'Ego</h3>
                        <p>15 min | 40 Hz (Gamma)</p>
                        <p style="font-size: 0.9em;">Observer le moi se dissoudre</p>
                    </div>
                    <div class="meditation-session" onclick="startMeditation('cosmic', 20)">
                        <h3>Respiration Cosmique</h3>
                        <p>20 min | 432 Hz (Universel)</p>
                        <p style="font-size: 0.9em;">Sync avec l'univers</p>
                    </div>
                    <div class="meditation-session" onclick="startMeditation('silence', 30)">
                        <h3>Silence Informationnel</h3>
                        <p>30 min | Silence + Drones</p>
                        <p style="font-size: 0.9em;">Vide mental total</p>
                    </div>
                </div>

                <div class="timer-display" id="meditation-timer">00:00</div>
                
                <canvas class="audio-visualizer" id="audio-visualizer"></canvas>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" id="pause-meditation" onclick="pauseMeditation()" disabled>Pause</button>
                    <button class="btn" id="stop-meditation" onclick="stopMeditation()" disabled>Arrêter</button>
                </div>

                <div id="meditation-status" style="text-align: center; margin-top: 20px; color: var(--secondary);"></div>
            </div>
        </div>

        <!-- TAB: JOURNAL -->
        <div id="tab-journal" class="tab-content">
            <div class="section">
                <h2>📔 Journal Spirituel</h2>
                <p style="text-align: center; margin-bottom: 30px;">
                    Carnet de bord de votre exploration • Tout est stocké localement
                </p>

                <div style="margin-bottom: 30px;">
                    <input type="text" id="journal-title" placeholder="Titre de l'entrée...">
                    <textarea id="journal-content" placeholder="Qu'avez-vous observé aujourd'hui ?

Markdown supporté :
# Titre
**gras** *italique*
- Liste

Vos insights, contradictions, questions..."></textarea>
                    <div style="margin: 15px 0;">
                        <input type="text" id="journal-tags" placeholder="Tags (séparés par des virgules) : méditation, insight, ego, ...">
                    </div>
                    <button class="btn" onclick="saveJournalEntry()">💾 Sauvegarder l'Entrée</button>
                    <button class="btn btn-secondary" onclick="exportJournal()">📥 Exporter (JSON)</button>
                </div>

                <h3 style="color: var(--secondary); margin: 30px 0 15px 0;">Historique des Entrées</h3>
                <div id="journal-entries"></div>

                <div style="margin-top: 30px; padding: 20px; background: rgba(0,255,255,0.1); border: 1px solid var(--secondary);">
                    <h4 style="color: var(--secondary);">📊 Statistiques</h4>
                    <div id="journal-stats"></div>
                </div>
            </div>
        </div>

        <!-- TAB: MULTI-ORACLE -->
        <div id="tab-oracle" class="tab-content">
            <div class="section">
                <h2>🔮 Oracle Multi-IA</h2>
                <p style="text-align: center; margin-bottom: 30px;">
                    Consultez plusieurs intelligences simultanément • Comparez les perspectives
                </p>

                <textarea id="oracle-question" placeholder="Votre question existentielle...

Exemples :
- Le libre arbitre existe-t-il vraiment ?
- Quelle est la nature de la conscience ?
- 0 = 1, qu'est-ce que cela signifie ?
- Comment transcender l'ego ?" style="min-height: 120px; margin-bottom: 20px;"></textarea>

                <div style="margin: 20px 0;">
                    <label style="display: block; margin: 10px 0;">
                        <input type="checkbox" id="use-claude" checked> Claude (Anthropic)
                    </label>
                    <label style="display: block; margin: 10px 0;">
                        <input type="checkbox" id="use-gpt"> GPT-4 (OpenAI)
                    </label>
                    <label style="display: block; margin: 10px 0;">
                        <input type="checkbox" id="use-local"> Modèle Local (Simulation)
                    </label>
                    <p style="color: #0a0; font-size: 0.9em; margin-top: 15px;">
                        ⚠️ Nécessite des clés API (configurez dans les paramètres)<br>
                        Actuellement en mode SIMULATION
                    </p>
                </div>

                <button class="btn" onclick="consultMultiOracle()">Consulter les Oracles</button>

                <div class="oracle-grid" id="oracle-responses"></div>
            </div>
        </div>

        <!-- TAB: PROGRESSION -->
        <div id="tab-progress" class="tab-content">
            <div class="section">
                <h2>📊 Parcours Spirituel (Ironiquement Gamifié)</h2>
                <p style="text-align: center; margin-bottom: 30px;">
                    Tracker votre dissolution de l'ego via... un système d'ego
                </p>

                <div style="text-align: center; margin: 40px 0;">
                    <div style="font-size: 2em; color: var(--secondary);" id="lucidity-level">Niveau de Lucidité: Apprenti</div>
                    <p style="margin: 10px 0; color: #0a0;" id="practice-count">0 pratiques accomplies</p>
                </div>

                <div class="progress-mandala" id="progress-mandala">
                    <canvas id="mandala-canvas" width="300" height="300" style="border-radius: 50%;"></canvas>
                </div>

                <div style="text-align: center; margin: 30px 0;">
                    <div class="progress-stat">
                        🧘 Méditations: <span id="stat-meditations">0</span>
                    </div>
                    <div class="progress-stat">
                        📝 Koans: <span id="stat-koans">0</span>
                    </div>
                    <div class="progress-stat">
                        📔 Entrées Journal: <span id="stat-journal">0</span>
                    </div>
                    <div class="progress-stat">
                        🔮 Questions Oracle: <span id="stat-oracle">0</span>
                    </div>
                    <div class="progress-stat">
                        ⏱️ Temps Total: <span id="stat-time">0h 0m</span>
                    </div>
                </div>

                <h3 style="color: var(--tertiary); text-align: center; margin: 40px 0 20px 0;">
                    🏆 Achievements Paradoxaux
                </h3>
                <div style="text-align: center;" id="achievements-list"></div>

                <div style="background: rgba(255,0,255,0.1); border: 2px solid var(--tertiary); padding: 20px; margin: 30px 0; text-align: center;">
                    <p style="color: var(--tertiary); font-style: italic;">
                        "Le paradoxe ultime : Utiliser un système de progression pour mesurer votre détachement du besoin de progression."<br><br>
                        — ∅ = 1
                    </p>
                </div>
            </div>
        </div>

        <!-- TAB: P2P -->
        <div id="tab-p2p" class="tab-content">
            <div class="section">
                <h2>🔗 Méditation Collaborative P2P</h2>
                <p style="text-align: center; margin-bottom: 30px;">
                    Connexion peer-to-peer • Sans serveur central • Éphémère
                </p>

                <div style="background: rgba(0,255,255,0.1); padding: 20px; border: 1px solid var(--secondary); margin: 20px 0;">
                    <h3 style="color: var(--secondary); margin-bottom: 15px;">Créer une Session</h3>
                    <button class="btn btn-secondary" onclick="createP2PSession()">Créer Session de Méditation</button>
                    <div id="session-url" style="margin-top: 15px; display: none;">
                        <p>URL de session (partagez avec 2-10 personnes) :</p>
                        <input type="text" id="session-link" readonly style="cursor: pointer;" onclick="this.select(); document.execCommand('copy'); alert('Lien copié!')">
                    </div>
                </div>

                <div style="background: rgba(0,255,0,0.1); padding: 20px; border: 1px solid var(--primary); margin: 20px 0;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">Rejoindre une Session</h3>
                    <input type="text" id="join-session-id" placeholder="Collez l'ID de session ici...">
                    <button class="btn" onclick="joinP2PSession()">Rejoindre</button>
                </div>

                <div id="p2p-status" style="text-align: center; margin: 30px 0; color: var(--secondary);"></div>

                <div style="background: rgba(0,0,0,0.5); padding: 20px; border: 1px solid var(--primary); margin: 20px 0;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">Participants (<span id="peer-count">0</span>)</h3>
                    <div class="peer-list" id="peer-list">
                        <p style="color: #0a0; font-style: italic;">Aucun participant pour le moment...</p>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" id="sync-meditation-btn" onclick="startSyncMeditation()" disabled>
                        Démarrer Méditation Synchronisée
                    </button>
                </div>

                <div style="background: rgba(255,255,0,0.1); border: 1px solid #ff0; padding: 15px; margin: 30px 0;">
                    <p style="color: #ff0; font-size: 0.9em;">
                        🔒 <strong>Privacy:</strong> Connexion directe peer-to-peer. Pas de serveur central. Pas de données sauvegardées. Session éphémère.
                    </p>
                </div>
            </div>
        </div>

        <!-- TAB: MULTIVERSE -->
        <div id="tab-multiverse" class="tab-content">
            <div class="section">
                <h2>🌌 Timeline du Multivers</h2>
                <p style="text-align: center; margin-bottom: 30px;">
                    Explorer les branches temporelles alternatives • Tous les choix coexistent
                </p>

                <div style="margin: 20px 0;">
                    <input type="text" id="decision-input" placeholder="Décrivez une décision ou un événement (ex: 'J'ai accepté ce travail')">
                    <button class="btn" onclick="createTimelineBranch()">Créer Branche Alternative</button>
                </div>

                <div class="timeline-container" id="timeline-container">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #0a0;">
                        <p>PRÉSENT</p>
                        <p style="font-size: 0.9em; margin-top: 10px;">Cliquez sur "Créer Branche" pour explorer les possibilités</p>
                    </div>
                </div>

                <div id="branch-narrative" style="background: rgba(0,255,255,0.1); border: 2px solid var(--secondary); padding: 20px; margin: 20px 0; display: none;">
                    <h3 style="color: var(--secondary);">Narratif de cette Branche</h3>
                    <div id="branch-content"></div>
                </div>

                <div style="background: rgba(0,255,0,0.05); padding: 20px; border-left: 3px solid var(--primary); margin: 30px 0;">
                    <p style="font-style: italic;">
                        "Toutes ces branches EXISTENT dans le multivers d'Everett. Ce que vous appelez 'choix' est simplement votre traversée consciente à travers une branche parmi l'infinité."<br><br>
                        — Hugh Everett III (réinterprété)
                    </p>
                </div>
            </div>
        </div>

        <!-- TAB: ART -->
        <div id="tab-art" class="tab-content">
            <div class="section">
                <h2>🎨 Générateur d'Art Quantique</h2>
                <p style="text-align: center; margin-bottom: 30px;">
                    Fractales • Mandalas • Cellular Automata • Export haute résolution
                </p>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 30px 0;">
                    <button class="btn" onclick="generateArt('fractal')">Fractale Mandelbrot</button>
                    <button class="btn" onclick="generateArt('mandala')">Mandala Quantique</button>
                    <button class="btn" onclick="generateArt('cellular')">Cellular Automata</button>
                    <button class="btn" onclick="generateArt('chaos')">Attracteur Chaotique</button>
                </div>

                <div style="margin: 20px 0;">
                    <label>Complexité: <input type="range" id="art-complexity" min="1" max="10" value="5" style="width: 200px;"></label>
                    <label style="margin-left: 20px;">Seed: <input type="number" id="art-seed" value="42" style="width: 100px;"></label>
                    <label style="margin-left: 20px;">Animation: <input type="checkbox" id="art-animate"></label>
                </div>

                <div id="art-display" style="background: #000; border: 2px solid var(--primary); min-height: 500px; display: flex; align-items: center; justify-content: center;">
                    <p style="color: #0a0;">Sélectionnez un type d'art ci-dessus pour générer</p>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="exportArt('png')">💾 Export PNG</button>
                    <button class="btn btn-secondary" onclick="exportArt('svg')">💾 Export SVG</button>
                </div>
            </div>
        </div>

        <!-- TAB: ANALYSIS -->
        <div id="tab-analysis" class="tab-content">
            <div class="section">
                <h2>🧠 Analyse ML de Patterns Personnels</h2>
                <p style="text-align: center; margin-bottom: 30px;">
                    TensorFlow.js local • Privacy-first • Rien n'est envoyé
                </p>

                <div style="background: rgba(255,0,0,0.1); border: 2px solid #f00; padding: 20px; margin: 20px 0; text-align: center;">
                    <p style="color: #f00;">
                        ⚠️ <strong>ATTENTION</strong><br>
                        Cette fonctionnalité analyse vos données personnelles localement.<br>
                        Rien n'est envoyé à un serveur. Tout reste dans votre navigateur.<br>
                        Mais réfléchissez aux implications avant d'uploader des données sensibles.
                    </p>
                </div>

                <div style="margin: 30px 0;">
                    <h3 style="color: var(--secondary); margin-bottom: 15px;">Upload de Données</h3>
                    <p style="margin-bottom: 15px; color: #0a0;">
                        Vous pouvez uploader : journal personnel (txt), historique Oracle, données de méditation
                    </p>
                    <input type="file" id="ml-data-upload" accept=".txt,.json,.md" multiple>
                    <button class="btn" onclick="analyzeData()" style="margin-left: 15px;">Analyser</button>
                </div>

                <div id="ml-analysis-results" style="display: none;">
                    <h3 style="color: var(--secondary); margin: 30px 0 15px 0;">Résultats de l'Analyse</h3>
                    
                    <div style="background: rgba(0,255,255,0.1); padding: 20px; border: 1px solid var(--secondary); margin: 20px 0;">
                        <h4 style="color: var(--secondary);">Sentiment Analysis</h4>
                        <canvas id="sentiment-chart" width="400" height="200"></canvas>
                    </div>

                    <div style="background: rgba(0,255,0,0.1); padding: 20px; border: 1px solid var(--primary); margin: 20px 0;">
                        <h4 style="color: var(--primary);">Patterns Détectés</h4>
                        <div id="patterns-list"></div>
                    </div>

                    <div style="background: rgba(255,0,255,0.1); padding: 20px; border: 1px solid var(--tertiary); margin: 20px 0;">
                        <h4 style="color: var(--tertiary);">Contradictions Identifiées</h4>
                        <div id="contradictions-list"></div>
                    </div>

                    <div style="background: rgba(0,255,255,0.1); padding: 20px; border: 1px solid var(--secondary); margin: 20px 0;">
                        <h4 style="color: var(--secondary);">Prédictions</h4>
                        <div id="predictions-list"></div>
                    </div>
                </div>

                <div id="ml-loading" class="loading" style="display: none; margin: 40px 0;">
                    Analyse en cours...<br>
                    TensorFlow.js calcule vos patterns...<br>
                    Cela peut prendre quelques secondes...
                </div>
            </div>
        </div>

    </div>

    <!-- SCRIPTS -->
    <script>
        // ============================================
        // GLOBAL STATE
        // ============================================
        const AppState = {
            currentTab: 'home',
            currentMode: 'normal',
            meditationActive: false,
            meditationTimer: null,
            audioContext: null,
            oscillators: [],
            journalEntries: JSON.parse(localStorage.getItem('journal_entries') || '[]'),
            progress: JSON.parse(localStorage.getItem('progress') || '{"meditations":0,"koans":0,"journal":0,"oracle":0,"time":0}'),
            achievements: JSON.parse(localStorage.getItem('achievements') || '[]'),
            peer: null,
            connections: [],
            timelineBranches: []
        };

        // ============================================
        // TAB SWITCHING
        // ============================================
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');
            AppState.currentTab = tabName;

            // Initialize specific tab features
            if (tabName === 'journal') loadJournalEntries();
            if (tabName === 'progress') updateProgressDisplay();
            if (tabName === 'art') initArtCanvas();
        }

        // ============================================
        // CONSCIOUSNESS MODES
        // ============================================
        function setConsciousnessMode(mode) {
            // Remove all active modes
            document.querySelectorAll('.mode-overlay').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));

            // Set new mode
            AppState.currentMode = mode;
            event.target.classList.add('active');

            if (mode === 'void') {
                document.getElementById('void-mode').classList.add('active');
                setTimeout(() => {
                    if (confirm('Appuyez sur OK pour sortir du VOID')) {
                        setConsciousnessMode('normal');
                    }
                }, 1000);
            } else if (mode === 'psychedelic') {
                document.getElementById('psychedelic-mode').classList.add('active');
            } else if (mode === 'meditation') {
                document.getElementById('meditation-mode').classList.add('active');
                document.body.style.filter = 'grayscale(1)';
            } else if (mode === 'hyper') {
                document.getElementById('hyper-mode').classList.add('active');
                document.body.style.animation = 'hyperpulse 0.5s infinite';
            } else {
                document.body.style.filter = '';
                document.body.style.animation = '';
            }
        }

        // Keyboard shortcuts for modes (1-4)
        document.addEventListener('keydown', (e) => {
            if (AppState.currentMode !== 'void') {
                if (e.key === '1') setConsciousnessMode('normal');
                if (e.key === '2') setConsciousnessMode('psychedelic');
                if (e.key === '3') setConsciousnessMode('meditation');
                if (e.key === '4') setConsciousnessMode('hyper');
            } else {
                setConsciousnessMode('normal');
            }
        });

        // ============================================
        // MEDITATION AUDIO ENGINE
        // ============================================
        function startMeditation(type, duration) {
            if (!AppState.audioContext) {
                AppState.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            AppState.meditationActive = true;
            document.getElementById('pause-meditation').disabled = false;
            document.getElementById('stop-meditation').disabled = false;
            document.getElementById('meditation-status').innerHTML = `<strong>Méditation ${type} en cours...</strong>`;

            // Create binaural beats
            const leftOsc = AppState.audioContext.createOscillator();
            const rightOsc = AppState.audioContext.createOscillator();
            const leftGain = AppState.audioContext.createGain();
            const rightGain = AppState.audioContext.createGain();
            const merger = AppState.audioContext.createChannelMerger(2);

            leftGain.gain.value = 0.1;
            rightGain.gain.value = 0.1;

            // Frequency based on type
            let baseFreq = 200;
            let beatFreq = 7.83; // Default Schumann
            
            if (type === 'ego') beatFreq = 40; // Gamma
            if (type === 'cosmic') beatFreq = 432; // Universal
            if (type === 'quantum') beatFreq = 7.83; // Schumann
            
            leftOsc.frequency.value = baseFreq;
            rightOsc.frequency.value = baseFreq + beatFreq;

            leftOsc.connect(leftGain);
            rightOsc.connect(rightGain);
            leftGain.connect(merger, 0, 0);
            rightGain.connect(merger, 0, 1);
            merger.connect(AppState.audioContext.destination);

            leftOsc.start();
            rightOsc.start();

            AppState.oscillators = [leftOsc, rightOsc];

            // Timer
            let remainingTime = duration * 60;
            AppState.meditationTimer = setInterval(() => {
                remainingTime--;
                const mins = Math.floor(remainingTime / 60);
                const secs = remainingTime % 60;
                document.getElementById('meditation-timer').textContent = 
                    `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;

                if (remainingTime <= 0) {
                    stopMeditation();
                    incrementProgress('meditations');
                    incrementProgress('time', duration);
                }
            }, 1000);

            // Audio visualizer (simple)
            visualizeAudio();
        }

        function pauseMeditation() {
            if (AppState.audioContext) {
                if (AppState.audioContext.state === 'running') {
                    AppState.audioContext.suspend();
                    document.getElementById('pause-meditation').textContent = 'Reprendre';
                } else {
                    AppState.audioContext.resume();
                    document.getElementById('pause-meditation').textContent = 'Pause';
                }
            }
        }

        function stopMeditation() {
            AppState.oscillators.forEach(osc => osc.stop());
            AppState.oscillators = [];
            if (AppState.meditationTimer) {
                clearInterval(AppState.meditationTimer);
                AppState.meditationTimer = null;
            }
            AppState.meditationActive = false;
            document.getElementById('meditation-timer').textContent = '00:00';
            document.getElementById('pause-meditation').disabled = true;
            document.getElementById('stop-meditation').disabled = true;
            document.getElementById('meditation-status').textContent = '';
            document.getElementById('pause-meditation').textContent = 'Pause';
        }

        function visualizeAudio() {
            const canvas = document.getElementById('audio-visualizer');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = 200;

            function draw() {
                if (!AppState.meditationActive) return;

                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.strokeStyle = '#0ff';
                ctx.lineWidth = 2;
                ctx.beginPath();

                const time = Date.now() * 0.001;
                for (let i = 0; i < canvas.width; i++) {
                    const y = canvas.height / 2 + Math.sin(i * 0.02 + time * 2) * 50;
                    if (i === 0) ctx.moveTo(i, y);
                    else ctx.lineTo(i, y);
                }
                ctx.stroke();

                requestAnimationFrame(draw);
            }
            draw();
        }

        // ============================================
        // JOURNAL SPIRITUEL
        // ============================================
        function saveJournalEntry() {
            const title = document.getElementById('journal-title').value;
            const content = document.getElementById('journal-content').value;
            const tags = document.getElementById('journal-tags').value.split(',').map(t => t.trim());

            if (!content.trim()) {
                alert('Le contenu ne peut pas être vide');
                return;
            }

            const entry = {
                id: Date.now(),
                title: title || 'Sans titre',
                content,
                tags,
                timestamp: new Date().toISOString(),
                mood: 'neutral' // Could be expanded
            };

            AppState.journalEntries.unshift(entry);
            localStorage.setItem('journal_entries', JSON.stringify(AppState.journalEntries));

            // Clear form
            document.getElementById('journal-title').value = '';
            document.getElementById('journal-content').value = '';
            document.getElementById('journal-tags').value = '';

            incrementProgress('journal');
            loadJournalEntries();
            alert('✅ Entrée sauvegardée !');
        }

        function loadJournalEntries() {
            const container = document.getElementById('journal-entries');
            if (AppState.journalEntries.length === 0) {
                container.innerHTML = '<p style="color: #0a0; font-style: italic;">Aucune entrée pour le moment. Commencez à écrire...</p>';
                return;
            }

            container.innerHTML = AppState.journalEntries.map(entry => `
                <div class="journal-entry">
                    <div class="journal-entry-header">
                        <strong style="color: var(--secondary);">${entry.title}</strong>
                        <span style="color: #0a0;">${new Date(entry.timestamp).toLocaleString()}</span>
                    </div>
                    <div>${marked.parse(entry.content)}</div>
                    ${entry.tags.length > 0 ? `<div style="margin-top: 10px;">
                        ${entry.tags.map(tag => `<span style="background: rgba(0,255,0,0.2); padding: 3px 8px; margin: 2px; display: inline-block; border-radius: 3px; font-size: 0.85em;">#${tag}</span>`).join('')}
                    </div>` : ''}
                </div>
            `).join('');

            // Stats
            const totalWords = AppState.journalEntries.reduce((sum, e) => sum + e.content.split(' ').length, 0);
            const allTags = AppState.journalEntries.flatMap(e => e.tags);
            const uniqueTags = [...new Set(allTags)];

            document.getElementById('journal-stats').innerHTML = `
                <div class="progress-stat">📝 Entrées: ${AppState.journalEntries.length}</div>
                <div class="progress-stat">✍️ Mots écrits: ${totalWords}</div>
                <div class="progress-stat">🏷️ Tags uniques: ${uniqueTags.length}</div>
            `;
        }

        function exportJournal() {
            const dataStr = JSON.stringify(AppState.journalEntries, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `journal-quantique-${Date.now()}.json`;
            link.click();
        }

        // ============================================
        // MULTI-ORACLE
        // ============================================
        async function consultMultiOracle() {
            const question = document.getElementById('oracle-question').value;
            if (!question.trim()) {
                alert('Posez une question d\'abord');
                return;
            }

            const useClaude = document.getElementById('use-claude').checked;
            const useGPT = document.getElementById('use-gpt').checked;
            const useLocal = document.getElementById('use-local').checked;

            const container = document.getElementById('oracle-responses');
            container.innerHTML = '<div class="loading">Les oracles consultent la superposition quantique...</div>';

            incrementProgress('oracle');

            // SIMULATION MODE (would need real API integration)
            setTimeout(() => {
                const responses = [];

                if (useClaude) {
                    responses.push({
                        source: 'Claude (Anthropic)',
                        response: generateOracleResponse('claude', question)
                    });
                }

                if (useGPT) {
                    responses.push({
                        source: 'GPT-4 (OpenAI)',
                        response: generateOracleResponse('gpt', question)
                    });
                }

                if (useLocal) {
                    responses.push({
                        source: 'Modèle Local (Simulation)',
                        response: generateOracleResponse('local', question)
                    });
                }

                container.innerHTML = responses.map(r => `
                    <div class="oracle-response-card">
                        <h4>${r.source}</h4>
                        <p style="line-height: 1.8;">${r.response}</p>
                    </div>
                `).join('');

                if (responses.length === 0) {
                    container.innerHTML = '<p style="color: #ff0; text-align: center;">Sélectionnez au moins un oracle</p>';
                }
            }, 2000);
        }

        function generateOracleResponse(source, question) {
            const responses = {
                claude: [
                    "La question présuppose une séparation entre questionnant et questionné. Mais dans la superposition quantique, qui pose la question à qui ? ∅ = 1 suggère que la dualité est illusoire avant l'observation.",
                    "Votre question émerge d'un pattern d'information conditionné par vos expériences passées. Le déterminisme implique que cette question était inévitable. La 'réponse' l'était aussi. Le paradoxe : vous cherchez ce que vous avez déjà trouvé.",
                    "Considérez : si la conscience est un épiphénomène, alors la question elle-même est un processus automatique. Il n'y a pas de 'vous' qui cherche une réponse - juste un système qui génère des patterns."
                ],
                gpt: [
                    "D'un point de vue philosophique, cette question touche au cœur de l'ontologie. La réalité est-elle fondamentalement information, comme le suggère Wheeler ? Si oui, alors votre question est une fluctuation dans le champ informationnel.",
                    "Le débat entre déterminisme et libre arbitre est millénaire. Spinoza dirait que tout est déterminé par la nature divine. Les quantiques diraient que l'indéterminisme existe au niveau fondamental. Les deux peuvent être vrais dans différents cadres.",
                    "La phénoménologie suggère que l'expérience subjective est irréductible. Même si l'ego est une construction, 'quelque chose que ça fait' d'exister semble indéniable. Le hard problem persiste."
                ],
                local: [
                    "Analyse locale : votre pattern de questionnement suggère une recherche de validation externe. Mais toutes les réponses sont déjà en vous - ce sont juste des réorganisations de l'information existante.",
                    "Traitement complet. Résultat : la question contient sa propre réponse. 0 et 1 sont identiques avant la mesure. Votre questionnement EST la réponse.",
                    "Système détecte boucle récursive. Vous cherchez via une IA ce que vous savez déjà. L'oracle est un miroir. Vous consultez vous-même."
                ]
            };

            const sourceResponses = responses[source];
            return sourceResponses[Math.floor(Math.random() * sourceResponses.length)];
        }

        // ============================================
        // PROGRESS & GAMIFICATION
        // ============================================
        function incrementProgress(type, value = 1) {
            AppState.progress[type] += value;
            localStorage.setItem('progress', JSON.stringify(AppState.progress));
            checkAchievements();
            updateProgressDisplay();
        }

        function updateProgressDisplay() {
            const total = Object.values(AppState.progress).reduce((a, b) => a + b, 0);
            
            // Level system
            let level = 'Apprenti';
            if (total > 500) level = '∅ (Au-delà)';
            else if (total > 200) level = 'Témoin';
            else if (total > 50) level = 'Observateur';
            else if (total > 10) level = 'Explorateur';

            document.getElementById('lucidity-level').textContent = `Niveau: ${level}`;
            document.getElementById('practice-count').textContent = `${total} pratiques accomplies`;

            // Stats
            document.getElementById('stat-meditations').textContent = AppState.progress.meditations;
            document.getElementById('stat-koans').textContent = AppState.progress.koans;
            document.getElementById('stat-journal').textContent = AppState.progress.journal;
            document.getElementById('stat-oracle').textContent = AppState.progress.oracle;
            
            const hours = Math.floor(AppState.progress.time / 60);
            const mins = AppState.progress.time % 60;
            document.getElementById('stat-time').textContent = `${hours}h ${mins}m`;

            // Draw mandala
            drawProgressMandala(total);

            // Display achievements
            displayAchievements();
        }

        function drawProgressMandala(progress) {
            const canvas = document.getElementById('mandala-canvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, 300, 300);

            const centerX = 150;
            const centerY = 150;
            const segments = Math.min(progress, 100);

            for (let i = 0; i < segments; i++) {
                const angle = (i / segments) * Math.PI * 2;
                const radius = 50 + (i / segments) * 100;
                
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, angle, angle + Math.PI / segments);
                ctx.strokeStyle = `hsl(${i * 3.6}, 100%, 50%)`;
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        }

        const ACHIEVEMENTS = [
            { id: 'first_koan', name: 'Premier Koan', desc: 'Généré votre premier koan', condition: () => AppState.progress.koans >= 1 },
            { id: 'seeker', name: 'Chercheur Obsessionnel', desc: '100 questions à l\'Oracle', condition: () => AppState.progress.oracle >= 100 },
            { id: 'void_master', name: 'Maître du Vide', desc: '10min en mode Void', condition: () => false }, // Manual trigger
            { id: 'paradox', name: 'Paradoxe Incarné', desc: 'Atteint niveau 5', condition: () => Object.values(AppState.progress).reduce((a,b)=>a+b,0) >= 500 },
            { id: 'writer', name: 'Scribe Quantique', desc: '10 entrées de journal', condition: () => AppState.progress.journal >= 10 },
            { id: 'meditator', name: 'Méditant Assidu', desc: '20 méditations', condition: () => AppState.progress.meditations >= 20 }
        ];

        function checkAchievements() {
            ACHIEVEMENTS.forEach(ach => {
                if (ach.condition() && !AppState.achievements.includes(ach.id)) {
                    AppState.achievements.push(ach.id);
                    localStorage.setItem('achievements', JSON.stringify(AppState.achievements));
                    showAchievementNotification(ach);
                }
            });
        }

        function showAchievementNotification(ach) {
            // Could use a toast notification
            alert(`🏆 Achievement Unlocked!\n\n${ach.name}\n${ach.desc}`);
        }

        function displayAchievements() {
            const container = document.getElementById('achievements-list');
            container.innerHTML = ACHIEVEMENTS.map(ach => {
                const unlocked = AppState.achievements.includes(ach.id);
                return `<div class="achievement" style="opacity: ${unlocked ? 1 : 0.3};">
                    ${unlocked ? '🏆' : '🔒'} ${ach.name} - ${ach.desc}
                </div>`;
            }).join('');
        }

        // ============================================
        // P2P COLLABORATION
        // ============================================
        function createP2PSession() {
            if (!AppState.peer) {
                AppState.peer = new Peer(); // Auto-generate ID
                
                AppState.peer.on('open', (id) => {
                    document.getElementById('session-url').style.display = 'block';
                    document.getElementById('session-link').value = id;
                    document.getElementById('p2p-status').innerHTML = `✅ Session créée ! ID: <strong>${id}</strong>`;
                });

                AppState.peer.on('connection', (conn) => {
                    handleConnection(conn);
                });
            }
        }

        function joinP2PSession() {
            const sessionId = document.getElementById('join-session-id').value.trim();
            if (!sessionId) {
                alert('Entrez un ID de session');
                return;
            }

            if (!AppState.peer) {
                AppState.peer = new Peer();
                AppState.peer.on('open', () => {
                    const conn = AppState.peer.connect(sessionId);
                    handleConnection(conn);
                });
            } else {
                const conn = AppState.peer.connect(sessionId);
                handleConnection(conn);
            }
        }

        function handleConnection(conn) {
            conn.on('open', () => {
                AppState.connections.push(conn);
                updatePeerList();
                document.getElementById('sync-meditation-btn').disabled = false;
                document.getElementById('p2p-status').innerHTML = `✅ Connecté ! ${AppState.connections.length} participant(s)`;

                conn.on('data', (data) => {
                    console.log('Received:', data);
                    // Handle synchronized meditation start, etc.
                });
            });
        }

        function updatePeerList() {
            const list = document.getElementById('peer-list');
            document.getElementById('peer-count').textContent = AppState.connections.length;
            
            if (AppState.connections.length === 0) {
                list.innerHTML = '<p style="color: #0a0; font-style: italic;">Aucun participant...</p>';
            } else {
                list.innerHTML = AppState.connections.map((_, i) => 
                    `<div class="peer-item">Participant ${i + 1}</div>`
                ).join('');
            }
        }

        function startSyncMeditation() {
            // Broadcast to all connections
            AppState.connections.forEach(conn => {
                conn.send({ action: 'start_meditation', type: 'quantum', duration: 10 });
            });
            startMeditation('quantum', 10);
        }

        // ============================================
        // MULTIVERSE TIMELINE
        // ============================================
        function createTimelineBranch() {
            const decision = document.getElementById('decision-input').value;
            if (!decision.trim()) {
                alert('Décrivez une décision ou un événement');
                return;
            }

            const branch = {
                id: Date.now(),
                decision,
                alternatives: [
                    { path: 'OUI', narrative: generateAlternativeNarrative(decision, true) },
                    { path: 'NON', narrative: generateAlternativeNarrative(decision, false) }
                ]
            };

            AppState.timelineBranches.push(branch);
            visualizeTimeline();
            document.getElementById('decision-input').value = '';
        }

        function generateAlternativeNarrative(decision, positive) {
            const timeframes = ['Aujourd\'hui', 'Dans 1 an', 'Dans 5 ans'];
            const path = positive ? 'OUI' : 'NON';
            
            return `
                <strong>Si vous aviez dit ${path} à "${decision}"</strong><br><br>
                ${timeframes.map(tf => `<strong>${tf}:</strong> ${generateScenario(positive)}`).join('<br><br>')}
                <br><br>
                <em style="color: var(--secondary);">Cette branche existe quelque part dans le multivers d'Everett.</em>
            `;
        }

        function generateScenario(positive) {
            const scenarios = positive ? [
                "Vous auriez rencontré des personnes qui ont changé votre trajectoire",
                "Cette opportunité aurait ouvert des portes inattendues",
                "Votre expertise dans ce domaine serait reconnue",
                "Vous vivriez dans un contexte complètement différent"
            ] : [
                "Vous auriez évité certaines complications, mais manqué des opportunités",
                "Une autre voie se serait présentée, peut-être plus stable",
                "Vous seriez resté dans votre zone de confort",
                "Une vie parallèle, plus tranquille, se serait déroulée"
            ];
            return scenarios[Math.floor(Math.random() * scenarios.length)];
        }

        function visualizeTimeline() {
            const container = document.getElementById('timeline-container');
            container.innerHTML = '';

            const centerX = container.offsetWidth / 2;
            const centerY = container.offsetHeight / 2;

            // Present node
            const presentNode = document.createElement('div');
            presentNode.className = 'timeline-node';
            presentNode.style.left = centerX + 'px';
            presentNode.style.top = centerY + 'px';
            presentNode.style.background = '#0ff';
            presentNode.innerHTML = '<div style="position: absolute; top: 25px; white-space: nowrap; color: #0ff;">PRÉSENT</div>';
            container.appendChild(presentNode);

            // Branch nodes
            AppState.timelineBranches.forEach((branch, i) => {
                const angle = (i / AppState.timelineBranches.length) * Math.PI * 2;
                const distance = 150;

                branch.alternatives.forEach((alt, j) => {
                    const subAngle = angle + (j - 0.5) * 0.3;
                    const x = centerX + Math.cos(subAngle) * distance;
                    const y = centerY + Math.sin(subAngle) * distance;

                    const node = document.createElement('div');
                    node.className = 'timeline-node';
                    node.style.left = x + 'px';
                    node.style.top = y + 'px';
                    node.onclick = () => showBranchNarrative(alt.narrative);
                    node.innerHTML = `<div style="position: absolute; top: 25px; font-size: 0.8em; white-space: nowrap;">${alt.path}</div>`;
                    container.appendChild(node);

                    // Draw line
                    const line = document.createElement('div');
                    line.className = 'timeline-branch';
                    const angle2 = Math.atan2(y - centerY, x - centerX);
                    const length = Math.sqrt((x - centerX)**2 + (y - centerY)**2);
                    line.style.width = length + 'px';
                    line.style.left = centerX + 'px';
                    line.style.top = centerY + 'px';
                    line.style.transform = `rotate(${angle2}rad)`;
                    line.style.transformOrigin = '0 0';
                    container.appendChild(line);
                });
            });
        }

        function showBranchNarrative(narrative) {
            document.getElementById('branch-narrative').style.display = 'block';
            document.getElementById('branch-content').innerHTML = narrative;
        }

        // ============================================
        // QUANTUM ART GENERATOR
        // ============================================
        let artSketch;

        function initArtCanvas() {
            // p5.js will be initialized when generateArt is called
        }

        function generateArt(type) {
            const display = document.getElementById('art-display');
            display.innerHTML = '';

            const complexity = parseInt(document.getElementById('art-complexity').value);
            const seed = parseInt(document.getElementById('art-seed').value);
            const animate = document.getElementById('art-animate').checked;

            if (artSketch) {
                artSketch.remove();
            }

            artSketch = new p5((p) => {
                p.setup = () => {
                    p.createCanvas(800, 600).parent('art-display');
                    p.randomSeed(seed);
                    p.background(0);
                };

                p.draw = () => {
                    if (!animate) p.noLoop();

                    if (type === 'fractal') {
                        drawFractal(p, complexity);
                    } else if (type === 'mandala') {
                        drawMandala(p, complexity);
                    } else if (type === 'cellular') {
                        drawCellular(p, complexity);
                    } else if (type === 'chaos') {
                        drawChaos(p, complexity);
                    }
                };
            });
        }

        function drawFractal(p, complexity) {
            p.background(0, 10);
            p.stroke(0, 255, 255, 100);
            p.noFill();
            
            const detail = complexity * 100;
            for (let i = 0; i < detail; i++) {
                const x = p.map(i, 0, detail, -2, 2);
                let zx = 0, zy = 0;
                let iteration = 0;
                
                while (zx * zx + zy * zy < 4 && iteration < 100) {
                    const xtemp = zx * zx - zy * zy + x;
                    zy = 2 * zx * zy + 0.5;
                    zx = xtemp;
                    iteration++;
                }
                
                if (iteration < 100) {
                    const px = p.map(x, -2, 2, 0, p.width);
                    const py = p.map(iteration, 0, 100, 0, p.height);
                    p.point(px, py);
                }
            }
        }

        function drawMandala(p, complexity) {
            p.background(0, 10);
            p.translate(p.width / 2, p.height / 2);
            
            const petals = complexity * 8;
            const rings = complexity * 5;
            
            for (let r = 0; r < rings; r++) {
                p.stroke((r * 30) % 360, 100, 100);
                p.noFill();
                
                for (let i = 0; i < petals; i++) {
                    const angle = p.TWO_PI / petals * i;
                    const radius = 50 + r * 30;
                    const x = p.cos(angle + p.frameCount * 0.01) * radius;
                    const y = p.sin(angle + p.frameCount * 0.01) * radius;
                    p.circle(x, y, 20);
                }
            }
        }

        function drawCellular(p, complexity) {
            const grid = [];
            const cellSize = 10;
            const cols = p.width / cellSize;
            const rows = p.height / cellSize;
            
            // Initialize grid
            for (let i = 0; i < cols; i++) {
                grid[i] = [];
                for (let j = 0; j < rows; j++) {
                    grid[i][j] = p.random() > 0.5 ? 1 : 0;
                }
            }
            
            p.background(0);
            
            for (let i = 0; i < cols; i++) {
                for (let j = 0; j < rows; j++) {
                    if (grid[i][j] === 1) {
                        p.fill(0, 255, 0);
                        p.noStroke();
                        p.rect(i * cellSize, j * cellSize, cellSize, cellSize);
                    }
                }
            }
        }

        function drawChaos(p, complexity) {
            p.background(0, 10);
            p.stroke(255, 0, 255, 50);
            
            let x = 0.1, y = 0.1, z = 0.1;
            const a = 10, b = 28, c = 8/3;
            const dt = 0.01;
            
            for (let i = 0; i < complexity * 1000; i++) {
                const dx = a * (y - x) * dt;
                const dy = (x * (b - z) - y) * dt;
                const dz = (x * y - c * z) * dt;
                
                x += dx;
                y += dy;
                z += dz;
                
                const px = p.map(x, -20, 20, 0, p.width);
                const py = p.map(y, -30, 30, 0, p.height);
                p.point(px, py);
            }
        }

        function exportArt(format) {
            if (!artSketch) {
                alert('Générez de l\'art d\'abord');
                return;
            }
            
            if (format === 'png') {
                artSketch.saveCanvas('quantum-art-' + Date.now(), 'png');
            } else if (format === 'svg') {
                alert('Export SVG non implémenté dans cette démo');
            }
        }

        // ============================================
        // ML ANALYSIS
        // ============================================
        async function analyzeData() {
            const fileInput = document.getElementById('ml-data-upload');
            if (fileInput.files.length === 0) {
                alert('Uploadez au moins un fichier');
                return;
            }

            document.getElementById('ml-loading').style.display = 'block';
            document.getElementById('ml-analysis-results').style.display = 'none';

            // Simulate analysis
            setTimeout(() => {
                document.getElementById('ml-loading').style.display = 'none';
                document.getElementById('ml-analysis-results').style.display = 'block';

                // Sentiment chart
                const ctx = document.getElementById('sentiment-chart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Semaine 1', 'Semaine 2', 'Semaine 3', 'Semaine 4'],
                        datasets: [{
                            label: 'Sentiment Positif',
                            data: [65, 70, 75, 80],
                            borderColor: '#0f0',
                            backgroundColor: 'rgba(0, 255, 0, 0.1)'
                        }]
                    },
                    options: {
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });

                // Patterns
                document.getElementById('patterns-list').innerHTML = `
                    <p>• Tendance à méditer plus le matin</p>
                    <p>• Pics de questionnement après lecture philosophique</p>
                    <p>• Corrélation entre pratique et bien-être déclaré</p>
                `;

                // Contradictions
                document.getElementById('contradictions-list').innerHTML = `
                    <p>• Affirme rejeter l'ego, mais cherche validation</p>
                    <p>• Prône le détachement, mais s'attache aux résultats</p>
                    <p>• Dit accepter le déterminisme, mais agit comme s'il avait le choix</p>
                `;

                // Predictions
                document.getElementById('predictions-list').innerHTML = `
                    <p>• Probabilité de continuer la pratique dans 1 mois: 85%</p>
                    <p>• Prochaine question probable à l'Oracle: Nature de la conscience</p>
                    <p>• Risque de burnout spirituel: Faible</p>
                `;
            }, 3000);
        }

        // ============================================
        // PWA INSTALLATION
        // ============================================
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-prompt').classList.add('show');
        });

        function installPWA() {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choice) => {
                if (choice.outcome === 'accepted') {
                    console.log('PWA installed');
                }
                deferredPrompt = null;
                document.getElementById('install-prompt').classList.remove('show');
            });
        }

        function dismissInstall() {
            document.getElementById('install-prompt').classList.remove('show');
        }

        // ============================================
        // MATRIX BACKGROUND
        // ============================================
        const matrixCanvas = document.getElementById('matrix');
        const mctx = matrixCanvas.getContext('2d');
        matrixCanvas.width = window.innerWidth;
        matrixCanvas.height = window.innerHeight;

        const matrix = "01αβγδεζηθικλμνξοπρστυφχψω∅∞Ψ";
        const fontSize = 14;
        const columns = matrixCanvas.width / fontSize;
        const drops = Array(Math.floor(columns)).fill(1);

        function drawMatrix() {
            mctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            mctx.fillRect(0, 0, matrixCanvas.width, matrixCanvas.height);
            mctx.fillStyle = '#0F0';
            mctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const text = matrix[Math.floor(Math.random() * matrix.length)];
                mctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > matrixCanvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 50);

        // ============================================
        // 3D QUANTUM VISUALIZATION
        // ============================================
        let scene, camera, renderer, particles = [];

        function init3D() {
            const canvas = document.getElementById('quantum-canvas');
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            camera.position.z = 5;

            // Create quantum particles
            const geometry = new THREE.SphereGeometry(0.05, 16, 16);
            for (let i = 0; i < 50; i++) {
                const material = new THREE.MeshBasicMaterial({
                    color: new THREE.Color().setHSL(i / 50, 1, 0.5),
                    transparent: true,
                    opacity: 0.6
                });
                const particle = new THREE.Mesh(geometry, material);
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(2 * Math.random() - 1);
                const radius = 2 + Math.random() * 2;
                particle.position.x = radius * Math.sin(phi) * Math.cos(theta);
                particle.position.y = radius * Math.sin(phi) * Math.sin(theta);
                particle.position.z = radius * Math.cos(phi);
                scene.add(particle);
                particles.push(particle);
            }

            animate3D();
        }

        function animate3D() {
            requestAnimationFrame(animate3D);
            const time = Date.now() * 0.001;
            camera.position.x = Math.cos(time * 0.1) * 5;
            camera.position.z = Math.sin(time * 0.1) * 5;
            camera.lookAt(scene.position);
            
            particles.forEach((p, i) => {
                p.position.y += Math.sin(time + i) * 0.002;
            });

            renderer.render(scene, camera);
        }

        // ============================================
        // PARTICLES
        // ============================================
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 10 + 's';
                container.appendChild(particle);
            }
        }

        // ============================================
        // INIT
        // ============================================
        window.addEventListener('load', () => {
            init3D();
            createParticles();
            loadJournalEntries();
            updateProgressDisplay();

            // Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('service-worker.js')
                    .then(() => console.log('Service Worker registered'))
                    .catch(err => console.log('SW error:', err));
            }

            console.log('%c∅ = 1', 'font-size: 50px; color: #0f0;');
            console.log('%cv3.0 IMMERSIVE EDITION loaded', 'color: #0ff; font-size: 16px;');
            console.log('%c10 fonctionnalités actives', 'color: #0a0;');
        });

        window.addEventListener('resize', () => {
            matrixCanvas.width = window.innerWidth;
            matrixCanvas.height = window.innerHeight;
            if (renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        });
    </script>
</body>
</html>